1 - mkdir app-with-sequelize && cd app-with-sequelize
2 - npm init -y
3 - npm install sequelize
4 - npm install -D sequelize-cli
5 - npm install mysql2
6 - mkdir src
7 - npm install -D sequelize-cli
8 - npm install mysql2
9 - mkdir src
10 - cd src
11 - npx sequelize-cli init
    Esse comando vai criar as seguintes pastas:
    config: contÃ©m um arquivo de configuraÃ§Ã£o, com orientaÃ§Ãµes para o CLI se conectar com o nosso banco de dados;
    models: contÃ©m todos os modelos da nossa aplicaÃ§Ã£o;
    migrations: contÃ©m todos os arquivos de migraÃ§Ã£o da nossa aplicaÃ§Ã£o;
    seeders: contÃ©m todos os arquivos de â€œseedsâ€ (sementes que sÃ£o usadas para popular o banco).


 3ï¸âƒ£ ConexÃ£o com o banco de dados

âž¡ï¸ Agora precisamos configurar o arquivo config.json gerado pelo init do CLI. Ao alterar esse arquivo, estamos configurando o acesso da aplicaÃ§Ã£o ao nosso banco de dados.

âž¡ï¸ Note que no nosso arquivo config.json, dentro da pasta config, as informaÃ§Ãµes sensÃ­veis, como credenciais de acesso ao banco de dados, estÃ£o todas expostas no nosso cÃ³digo. Uma boa prÃ¡tica Ã© usar variÃ¡veis de ambiente para controlar o que estiver relacionado Ã  configuraÃ§Ã£o geral da aplicaÃ§Ã£o. EntÃ£o, bora fazer isso do jeito certo!

âž¡ï¸ Vamos fazer a instalaÃ§Ã£o do pacote dotenv:

12 - npm install dotenv

Mudaremos o nome do nosso arquivo config.json para config.js

âž¡ï¸ Retiraremos todo o conteÃºdo de config.js e substituiremos pelo cÃ³digo abaixo:


    require('dotenv').config();

    const config = {
      username: process.env.MYSQL_USER,
      password: process.env.MYSQL_PASSWORD,
      database: process.env.MYSQL_DATABASE,
      host: process.env.MYSQL_HOST,
      dialect: 'mysql',
    };

    module.exports = {
      development: config,
      test: config,
      production: config,
    };

Note que vamos assumir que os trÃªs ambientes vÃ£o utilizar configuraÃ§Ãµes semelhantes. Em aplicaÃ§Ãµes mais complexas, no entanto, Ã© possÃ­vel que vocÃª utilize bancos de dados e configuraÃ§Ãµes diferentes para cada ambiente. Nesses casos, elas devem ser configuradas por meio de variÃ¡veis de ambiente.

âž¡ï¸ Vamos entender melhor as informaÃ§Ãµes que estamos passando:

    UsuÃ¡rio de acesso ao banco de dados;
    Senha de acesso ao banco de dados;
    Nome do banco de dados no qual queremos conectar;
    Host que estamos conectando - por ser local, utilizamos o 127.0.0.1;
    Dialect, que se refere a qual banco estamos utilizando. Nesse caso, â€œmysqlâ€.

Crie o arquivo .env na raiz do projeto e preencha as variÃ¡veis com as suas credenciais para acessar o MySQL:

  MYSQL_USER=root
  MYSQL_PASSWORD=senha_mysql
  MYSQL_DATABASE=orm_example
  MYSQL_HOST=localhost

âž¡ï¸ Modifique a linha 9 do arquivo src/models/index.js para apontar para o arquivo config.js:

const config = require(__dirname + '/../config/config.json')[env]; // configuraÃ§Ã£o antiga
const config = require(__dirname + '/../config/config.js')[env];   // configuraÃ§Ã£o nova

âž¡ï¸ Antes de rodar os comandos Sequelize, precisamos garantir que temos uma instÃ¢ncia do MySQL rodando.

Caso vocÃª jÃ¡ tenha um container com uma imagem do MySQL, pode utilizÃ¡-lo ou usar o comando abaixo no terminal para criar e rodar um:

    âš ï¸ Garanta que a senha do banco esteja de acordo com a presente no .env. ðŸ˜‰

docker container run --name container-mysql -e MYSQL_ROOT_PASSWORD=senha_mysql -d -p 3306:3306 mysql:8.0.29

    Se vocÃª tiver o MySQL instalado em sua mÃ¡quina, inicie ele com sudo service mysql start (Linux) ou brew services start mysql (MacOS).

4ï¸âƒ£ O arquivo .sequelizerc

Por padrÃ£o, ao rodar um comando Sequelize os arquivos dentro das pastas de migrations, models, seeders e config seriam procurados somente na camada em que estivÃ©ssemos executando o comando. No nosso caso, como estamos utilizando a pasta src para abrigar os arquivos do Sequelize, caso executÃ¡ssemos um comando diretamente na raiz da aplicaÃ§Ã£o, irÃ­amos no deparar com um erro.

Podemos entrar na pasta src e executar estes comandos, como fizemos anteriormente, pois assim teremos Ãªxito. Mas caso fosse uma aplicaÃ§Ã£o maior, com mais camadas, aumentarÃ­amos a complexidade de subir e configurar a aplicaÃ§Ã£o.

Ã‰ neste momento que entra em cena o arquivo .sequelizerc. Ele Ã© um arquivo de configuraÃ§Ã£o que podemos utilizar caso seja preciso substituir o caminho padrÃ£o das pastas migrations, models, seeders ou config. Dessa forma, podemos construir um cÃ³digo com uma arquitetura mais organizada. â­

âž¡ï¸ Para configurar este arquivo, crie um arquivo com o nome .sequelizerc na raiz da aplicaÃ§Ã£o com o seguinte conteÃºdo:

const path = require('path');

module.exports = {
  'config': path.resolve('src', 'config', 'config.js'),
  'models-path': path.resolve('src', 'models'),
  'seeders-path': path.resolve('src', 'seeders'),
  'migrations-path': path.resolve('src', 'migrations'),
};

Vamos entender melhor as informaÃ§Ãµes deste arquivo:

    path: Ã© um mÃ³dulo interno do Node que nos fornece alguns utilitÃ¡rios para trabalharmos com caminhos de arquivos e diretÃ³rios;
    config: Ã© um caminho para o arquivo de configuraÃ§Ã£o;
    models-path: Ã© um caminho para o diretÃ³rio de models;
    seeders-path: Ã© um caminho para o diretÃ³rio de seeders;
    migrations-path: Ã© um caminho para o diretÃ³rio de migrations.

5ï¸âƒ£ CriaÃ§Ã£o do banco de dados usando o CLI do Sequelize

âž¡ï¸ Agora que iniciamos uma aplicaÃ§Ã£o do Sequelize e nosso banco de dados estÃ¡ rodando, podemos criar o banco de dados orm_example (que nomeamos no .env) por meio deste comando:

npx sequelize db:create

No seu terminal, o Sequelize vai avisar que o database foi criado. VocÃª pode verificar isso no prÃ³prio MySQL utilizando os comandos abaixo:

mysql -u root -p

âž¡ï¸ Digite a sua senha de acesso ao mysql e em seguida rode o comando abaixo:

show databases;

âž¡ï¸ Perceba que, a partir desses passos, o banco orm_example foi criado e vocÃª nÃ£o precisou escrever nenhuma linha de SQL para isso. Essa Ã© uma das primeiras vantagens que o Sequelize nos oferece. â­

Criar migrations

  --> npx sequelize migration:generate --name create-user

Criar seeders

  --> npx sequelize seed:generate --name users
  --> npx sequelize db:seed:all

Para reverter o seed, use o seguinte comando:

  --> npx sequelize db:seed:undo:all


