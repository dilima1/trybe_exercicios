1 - mkdir app-with-sequelize && cd app-with-sequelize
2 - npm init -y
3 - npm install sequelize
4 - npm install -D sequelize-cli
5 - npm install mysql2
6 - mkdir src
7 - npm install -D sequelize-cli
8 - npm install mysql2
9 - mkdir src
10 - cd src
11 - npx sequelize-cli init
    Esse comando vai criar as seguintes pastas:
    config: cont√©m um arquivo de configura√ß√£o, com orienta√ß√µes para o CLI se conectar com o nosso banco de dados;
    models: cont√©m todos os modelos da nossa aplica√ß√£o;
    migrations: cont√©m todos os arquivos de migra√ß√£o da nossa aplica√ß√£o;
    seeders: cont√©m todos os arquivos de ‚Äúseeds‚Äù (sementes que s√£o usadas para popular o banco).


 3Ô∏è‚É£ Conex√£o com o banco de dados

‚û°Ô∏è Agora precisamos configurar o arquivo config.json gerado pelo init do CLI. Ao alterar esse arquivo, estamos configurando o acesso da aplica√ß√£o ao nosso banco de dados.

‚û°Ô∏è Note que no nosso arquivo config.json, dentro da pasta config, as informa√ß√µes sens√≠veis, como credenciais de acesso ao banco de dados, est√£o todas expostas no nosso c√≥digo. Uma boa pr√°tica √© usar vari√°veis de ambiente para controlar o que estiver relacionado √† configura√ß√£o geral da aplica√ß√£o. Ent√£o, bora fazer isso do jeito certo!

‚û°Ô∏è Vamos fazer a instala√ß√£o do pacote dotenv:

12 - npm install dotenv

Mudaremos o nome do nosso arquivo config.json para config.js

‚û°Ô∏è Retiraremos todo o conte√∫do de config.js e substituiremos pelo c√≥digo abaixo:


    require('dotenv').config();

    const config = {
      username: process.env.MYSQL_USER,
      password: process.env.MYSQL_PASSWORD,
      database: process.env.MYSQL_DATABASE,
      host: process.env.MYSQL_HOST,
      dialect: 'mysql',
    };

    module.exports = {
      development: config,
      test: config,
      production: config,
    };

Note que vamos assumir que os tr√™s ambientes v√£o utilizar configura√ß√µes semelhantes. Em aplica√ß√µes mais complexas, no entanto, √© poss√≠vel que voc√™ utilize bancos de dados e configura√ß√µes diferentes para cada ambiente. Nesses casos, elas devem ser configuradas por meio de vari√°veis de ambiente.

‚û°Ô∏è Vamos entender melhor as informa√ß√µes que estamos passando:

    Usu√°rio de acesso ao banco de dados;
    Senha de acesso ao banco de dados;
    Nome do banco de dados no qual queremos conectar;
    Host que estamos conectando - por ser local, utilizamos o 127.0.0.1;
    Dialect, que se refere a qual banco estamos utilizando. Nesse caso, ‚Äúmysql‚Äù.

Crie o arquivo .env na raiz do projeto e preencha as vari√°veis com as suas credenciais para acessar o MySQL:

  MYSQL_USER=root
  MYSQL_PASSWORD=senha_mysql
  MYSQL_DATABASE=orm_example
  MYSQL_HOST=localhost

‚û°Ô∏è Modifique a linha 9 do arquivo src/models/index.js para apontar para o arquivo config.js:

const config = require(__dirname + '/../config/config.json')[env]; // configura√ß√£o antiga
const config = require(__dirname + '/../config/config.js')[env];   // configura√ß√£o nova

‚û°Ô∏è Antes de rodar os comandos Sequelize, precisamos garantir que temos uma inst√¢ncia do MySQL rodando.

Caso voc√™ j√° tenha um container com uma imagem do MySQL, pode utiliz√°-lo ou usar o comando abaixo no terminal para criar e rodar um:

    ‚ö†Ô∏è Garanta que a senha do banco esteja de acordo com a presente no .env. üòâ

docker container run --name container-mysql -e MYSQL_ROOT_PASSWORD=senha_mysql -d -p 3306:3306 mysql:8.0.29

    Se voc√™ tiver o MySQL instalado em sua m√°quina, inicie ele com sudo service mysql start (Linux) ou brew services start mysql (MacOS).

4Ô∏è‚É£ O arquivo .sequelizerc

Por padr√£o, ao rodar um comando Sequelize os arquivos dentro das pastas de migrations, models, seeders e config seriam procurados somente na camada em que estiv√©ssemos executando o comando. No nosso caso, como estamos utilizando a pasta src para abrigar os arquivos do Sequelize, caso execut√°ssemos um comando diretamente na raiz da aplica√ß√£o, ir√≠amos no deparar com um erro.

Podemos entrar na pasta src e executar estes comandos, como fizemos anteriormente, pois assim teremos √™xito. Mas caso fosse uma aplica√ß√£o maior, com mais camadas, aumentar√≠amos a complexidade de subir e configurar a aplica√ß√£o.

√â neste momento que entra em cena o arquivo .sequelizerc. Ele √© um arquivo de configura√ß√£o que podemos utilizar caso seja preciso substituir o caminho padr√£o das pastas migrations, models, seeders ou config. Dessa forma, podemos construir um c√≥digo com uma arquitetura mais organizada. ‚≠ê

‚û°Ô∏è Para configurar este arquivo, crie um arquivo com o nome .sequelizerc na raiz da aplica√ß√£o com o seguinte conte√∫do:

const path = require('path');

module.exports = {
  'config': path.resolve('src', 'config', 'config.js'),
  'models-path': path.resolve('src', 'models'),
  'seeders-path': path.resolve('src', 'seeders'),
  'migrations-path': path.resolve('src', 'migrations'),
};

Vamos entender melhor as informa√ß√µes deste arquivo:

    path: √© um m√≥dulo interno do Node que nos fornece alguns utilit√°rios para trabalharmos com caminhos de arquivos e diret√≥rios;
    config: √© um caminho para o arquivo de configura√ß√£o;
    models-path: √© um caminho para o diret√≥rio de models;
    seeders-path: √© um caminho para o diret√≥rio de seeders;
    migrations-path: √© um caminho para o diret√≥rio de migrations.

5Ô∏è‚É£ Cria√ß√£o do banco de dados usando o CLI do Sequelize

‚û°Ô∏è Agora que iniciamos uma aplica√ß√£o do Sequelize e nosso banco de dados est√° rodando, podemos criar o banco de dados orm_example (que nomeamos no .env) por meio deste comando:

npx sequelize db:create

No seu terminal, o Sequelize vai avisar que o database foi criado. Voc√™ pode verificar isso no pr√≥prio MySQL utilizando os comandos abaixo:

mysql -u root -p

‚û°Ô∏è Digite a sua senha de acesso ao mysql e em seguida rode o comando abaixo:

show databases;

‚û°Ô∏è Perceba que, a partir desses passos, o banco orm_example foi criado e voc√™ n√£o precisou escrever nenhuma linha de SQL para isso. Essa √© uma das primeiras vantagens que o Sequelize nos oferece. ‚≠ê


